{% extends "base.html" %}

{% block title %}{{ post.title }} - Flask Blog{% endblock %}

{% block content %}
<div class="card">
    <h1>{{ post.title }}</h1>
    <div class="post-meta">
        By <strong><a href="{{ url_for('user_profile', user_id=post.author.id) }}" style="color: #5899dd;">{{ post.author.username }}</a></strong>
        on {{ post.created_at.strftime('%B %d, %Y at %I:%M %p') }}
        {% if post.updated_at > post.created_at %}
            <br>(Last updated: {{ post.updated_at.strftime('%B %d, %Y at %I:%M %p') }})
        {% endif %}
    </div>
    <div style="margin-top: 25px; white-space: pre-wrap;">{{ post.content }}</div>

    {% if current_user.is_authenticated and current_user.id == post.author_id %}
    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
        <a href="{{ url_for('edit_post', post_id=post.id) }}" class="btn btn-secondary">Edit Post</a>
        <form method="POST" action="{{ url_for('delete_post', post_id=post.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this post?');">
            <button type="submit" class="btn btn-danger">Delete Post</button>
        </form>
    </div>
    {% endif %}
</div>

<div class="card">
    <h2>Comments ({{ post.comments|length }})</h2>

    {% if post.comments %}
        {% for comment in post.comments %}
        <div class="comment">
            <strong><a href="{{ url_for('user_profile', user_id=comment.author.id) }}" style="color: #2c3e50;">{{ comment.author.username }}</a></strong>
            <span style="color: #7f8c8d; font-size: 0.9rem;"> - {{ comment.created_at.strftime('%B %d, %Y at %I:%M %p') }}</span>
            <p style="margin-top: 8px;">{{ comment.content }}</p>
            {% if current_user.is_authenticated and current_user.id == comment.author_id %}
            <form method="POST" action="{{ url_for('delete_comment', comment_id=comment.id) }}" style="margin-top: 10px;" onsubmit="return confirm('Delete this comment?');">
                <button type="submit" class="btn btn-danger" style="font-size: 0.9rem; padding: 5px 10px;">Delete</button>
            </form>
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <p style="margin-top: 15px; color: #7f8c8d;">No comments yet. Be the first to comment!</p>
    {% endif %}

    {% if current_user.is_authenticated %}
    <div class="comment-form">
        <h3>Add a Comment</h3>
        <form method="POST" action="{{ url_for('add_comment', post_id=post.id) }}">
            <div class="form-group">
                <textarea name="content" placeholder="Write your comment here..." required></textarea>
            </div>
            <button type="submit" class="btn">Post Comment</button>
        </form>
    </div>
    {% else %}
    <p style="margin-top: 20px;"><a href="{{ url_for('login') }}">Login</a> to leave a comment.</p>
    {% endif %}
</div>
{% endblock %}